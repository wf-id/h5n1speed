# Time is of the essence: effectiveness of dairy farm control strategies for H5N1 are limited by fast spread

This repository hosts the code, data and supporting analysis for “Time
is of the essence: effectiveness of dairy farm control for H5N1 is
limited by fast spread.” The analysis was structured in the form of an R
package to facilitate reproducibility.

## Installation

You can install the development version of rRsurveillance from
[GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("wf-id/h5n1speed")
```

## Running the analysis

The primary analysis scripts are available as:

- **R/generate_outbreak_chart.R** contains the code used to generate
  Figure 1, a figure of the ongoing H5N1 outbreak (available in
  `manuscript/figures/outbreak.pdf`)
- **manuscript/delay_strategy.qmd** contains the code to generate Figure
  2, panel A and assembles the figures to make Figure 2.
- **manuscript/intervention-effectiveness.R** contains the code to
  generate the figures shown in Figure 3 panels A-C which shows the
  effectiveness of each surveillance strategy and detection threshold at
  prevent infections.
- **manuscript/time-to-effective-strategy.R** contains the code to
  generate the time required to realize an effective strategy. These
  values are used to generate Figure 3 panels D-F.
- **dev/test-asymptomatic.R** contains the code to explore the role of
  asymptomatic transmission on detection and prevention of an outbreak
  and generates data for Figure 4A
- **dev/asymptomatic-test.R** contains the code to explore the
  contribution of asymptomatic transmission and delay in terms of
  relative risk and also generated the complted Figure 4 with panels
  B-C.
- **dev/conceptual.R** contains the code to generate the outputs used to
  make the conceptual figures shown in Figure 5.

Supplmental analysis:

- **dev/test-mortality.R** contains the code to explore the role of
  disease induced mortality on detection and prevention of an outbreak.

Please note that the R scripts were run across 38 threads on a single
node of the Wake Forest University HPC which took ~5-6hrs. Running these
scripts on a single machine may take a significantly long time.

## Underlying functions

We have parameterized our analysis into an R package to faciliate ease
of use and allow us to explore scenarios of speed on surveillance and
intervention strategies.

- `run_det_ode` contains the code used to run a deterministic
  compartmental model as described in our manuscript. This code use the
  deSolve package to solve the differential equations. Additionally,
  this code adds in the milk production.
- `detect_infections_ode` processes the outputs from the `run_det_ode`
  and find when some particular detection threshold has been met (e.g.,
  number of cows infected cumulatively, number of symptomatic cows with
  clinical signs, some proportion drop in milk production). This
  function returns a list object with the timepoint at which the
  detection threshold is met.
- `run_intervention_ode` allows a given intervention to be applied given
  some detection and surveillance approach (e.g., the number symptomatic
  detected) at that time with some delay with varying intensity.

## ODE System

As a reminder, the ODE is shown below:

$$\begin{aligned}
\frac{dS}{dt} & {= - \beta SI/N} \\
\frac{dI}{dt} & {= \beta SI/N - \gamma I} \\
\frac{dB}{dt} & {= \gamma I - \kappa B} \\
\frac{dR}{dt} & {= \kappa B} \\
 & 
\end{aligned}$$

Milk production is calculated as follows:

$$\text{Milk} = 100*(S + I) + 75*B + 80*R$$

# Package index

## All functions

- [`compartment_defn`](https://wf-id.github.io/h5n1speed/reference/compartment_defn.md)
  : Compartment definitions
- [`detect_infections_ode()`](https://wf-id.github.io/h5n1speed/reference/detect_infections_ode.md)
  : Detect Infection from ODE Solution
- [`format_det_ode_output()`](https://wf-id.github.io/h5n1speed/reference/format_det_ode_output.md)
  : Format deterministic output
- [`generate_outbreak_chart()`](https://wf-id.github.io/h5n1speed/reference/generate_outbreak_chart.md)
  : Generate the outbreak chart
- [`make_asym_r0()`](https://wf-id.github.io/h5n1speed/reference/make_asym_r0.md)
  : Create R0 for asymptomatic infections
- [`plot(`*`<rRsurveillace_deterministic>`*`)`](https://wf-id.github.io/h5n1speed/reference/plot.rRsurveillace_deterministic.md)
  : Ploting function
- [`r_to_gamma()`](https://wf-id.github.io/h5n1speed/reference/r_to_gamma.md)
  : Simple conversion of R0 to r
- [`run_det_ode()`](https://wf-id.github.io/h5n1speed/reference/run_det_ode.md)
  : Run ODE
- [`run_intervention_all_ode()`](https://wf-id.github.io/h5n1speed/reference/run_intervention_all_ode.md)
  : Estimate ODE Intervention outcomes
- [`run_intervention_ode()`](https://wf-id.github.io/h5n1speed/reference/run_intervention_ode.md)
  : Estimate ODE Intervention outcomes
- [`run_odin_vaccines()`](https://wf-id.github.io/h5n1speed/reference/run_odin_vaccines.md)
  : Run odin vaccine
- [`sigmoid_fun()`](https://wf-id.github.io/h5n1speed/reference/sigmoid_fun.md)
  : Sigmoid function

